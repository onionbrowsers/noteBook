# https加密整理

## 加密原因

**防止第三方的中间人攻击，对数据劫持**

## https加密的两种方法

### 对称加密

**类似于钥匙**

加密过程：

原文 + 密钥 =  密文

解密过程

密文 - 密钥 = 原文

类似于谍战电影里面，大家用同一本书作为加密解密的通用工具

+ 优点
  + 算法简单
  + 加密解密容易
  + 效率高执行快
+ 缺点
  + 不安全，密钥被第三方拿到即可解除数据，且不容易被发现
  + 需要经常更换密钥，存储多了很难以整理

### 非对称加密

**非对称加密有两个钥匙，及公钥（Public Key）和私钥（Private Key）。公钥和私钥是成对的存在，如果对原文使用公钥加密，则只能使用对应的私钥才能解密；因为加密和解密使用的不是同一把密钥，所以这种算法称之为非对称加密算法。**

**只有对应的私钥才能解开对应的公钥加密的原文**

**非对称加密算法的密匙是通过一系列算法获取到的一长串随机数，通常随机数的长度越长，加密信息越安全。通过私钥经过一系列算法是可以推导出公钥的，也就是说，公钥是基于私钥而存在的。但是无法通过公钥反向推倒出私钥，这个过程的单向的。**

+ 优点
  + 安全，即使密文被拦截，公钥暴露也没有对应的公钥解密
  + 不需要存储多份密钥
+ 缺点
  + 加密算法及其复杂
  + 安全性依赖算法与密钥，而且加密和解密效率很低



### 根据以上情况的优缺点，https可以使用对称加密和非对称加密方式（仍有漏洞，下文公布）

**具体操作如下**

1. 某网站拥有用于非对称加密的公钥A、私钥A’。
2. 浏览器向网站服务器请求，服务器把公钥A明文给传输浏览器。
3. 浏览器随机生成一个用于对称加密的密钥X，用公钥A加密后传给服务器。
4. 服务器拿到后用私钥A’解密得到密钥X。
5. 这样双方就都拥有密钥X了，且别人无法知道它。之后双方所有数据都通过密钥X加密解密即可。



### https对称加密+非对称加密的问题

1. 在上述第2步的时候，中间人可以拿到公钥A，
2. 保存下来，然后自己生成一对新的公钥B 私钥B`
3. 然后用自己的公钥b给到浏览器
4. 浏览器拿着中间人的公钥加密密钥
5. 中间人用服务端的公钥A去加密密文，给到服务端
6. 服务端用私钥A`解密拿到密文， 这样实现密钥劫持



### https对称加密+非对称加密的解决办法

**CA机构，证书颁发，相当于每一个网站的身份证**





#### 数字证书和数字签名

##### 数字证书

**数字证书有点类似于我们的居民身份证，只是数字证书是基于互联网通信的，用于标记通信双方身份的一种方式。数字证书是由权威机构Certificate Authority发行的，又称之为证书授权，简称为：CA。人们在网上可以根据它来识别对方身份信息。**

**网站在使用HTTPS前，需要向CA机构申领一份数字证书，数字证书里含有证书持有者信息、公钥信息等。服务器把证书传输给浏览器，浏览器从证书里获取公钥就行了，证书就如身份证，证明“该公钥对应该网站”。**

##### 防止证书被篡改的方法

我们把证书原本的内容生成一份“签名”，比对证书内容和签名是否一致就能判别是否被篡改。这就是数字证书的“防伪技术”，这里的“签名“就是数字签名

##### 数字签名

![img](https://pic2.zhimg.com/80/v2-7c78935389af46e197e96d9cd91c06dd_1440w.jpg)

##### 浏览器验证过程

1. 拿到明文T和加密后的数字签名S
2. 用CA机构的公钥解密数字签名S得到解密后的S`
3. 用CA结构决定的hash算法对明文T进行hash得到T`
4. 判断S\`和T\`是否相等，判断数据是否被劫持



### 完整流程

![img](https://pic2.zhimg.com/80/v2-a0d10af45e785fe8d3f5cd12f8c309f5_1440w.jpg)